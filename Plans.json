{
  "1_Purpose": {
    "main_objective": "PRD와 AGENTS.md를 단일 기준으로 삼아 OCR, 번역, 인페인팅, 식자 파이프라인을 6주 내 MVP로 정렬하고 페이지당 평균 30초 처리와 읽기 품질 게이트를 충족하는 구현 로드맵을 제공한다.",
    "hard_gate_definition": "Hard Gate는 input_text_count와 output_text_count 일치, bbox_overflow 0, min_font_pt 10 이상을 동시에 만족해야 한다.",
    "tdd_execution_principle": "모든 기능은 RED, GREEN, REFACTOR 순서로 진행하며 테스트가 명세를 대표하고 구현은 해당 테스트를 통과하는 최소 범위로 시작한다.",
    "document_mode": "future_implementation_roadmap",
    "horizon_weeks": 6
  },
  "2_Testing_Strategy": {
    "frameworks": {
      "backend": "Pytest",
      "frontend": "Vitest + Testing Library",
      "e2e": "Playwright"
    },
    "command_policy": "example_only",
    "principles": [
      "각 Phase는 테스트 명세를 먼저 작성하고 실패를 확인한 뒤 구현을 시작한다.",
      "Acceptance Criteria와 Edge Case를 동일 비중으로 관리해 회귀를 줄인다.",
      "GREEN 단계는 최소 구현으로 제한하고 구조 개선은 REFACTOR 단계로 분리한다.",
      "REFACTOR 단계에서도 테스트 집합은 변경 없이 통과 상태를 유지한다.",
      "E2E는 사용자 여정 전체를 대상으로 Hard Gate와 주요 오류 코드를 함께 검증한다.",
      "테스트 명령은 예시이며 실제 파일 경로는 구현 시점에 구체화한다.",
      "품질 게이트 통과 전에는 다음 Phase로 이동하지 않는다."
    ],
    "test_commands": [
      "pytest tests/api/test_auth.py -q",
      "pytest tests/api/test_jobs_create.py -q",
      "pytest tests/api/test_payments_prepare.py -q",
      "pytest tests/api/test_payments_confirm.py -q",
      "pytest tests/worker/test_pipeline_hard_gate.py -q",
      "pytest tests/api/test_pages_retry.py -q",
      "pytest tests/integration/test_metrics_kpi.py -q",
      "npm run test -- src/features/payments/payment-widget.spec.ts",
      "npm run test -- src/features/upload/upload.spec.ts",
      "npm run test -- src/features/jobs/job-detail.spec.ts",
      "npm run test:e2e -- tests/e2e/user-journey.spec.ts",
      "npm run test:e2e -- tests/e2e/payment-credit-topup.spec.ts"
    ],
    "temporary_assumptions": [
      "현재 저장소는 MVP 로드맵 중심 문서 단계이며 테스트 파일은 향후 구현 단계에서 생성한다.",
      "Frontend 단위 테스트 러너는 Vitest를 기준으로 가정하고 실제 스크립트 명은 구현 시 확정한다."
    ]
  },
  "3_Progress": [
    {
      "phase_id": 1,
      "feature": "Google 로그인/결제 승인 포함 인증, 업로드, 작업 생성 API 기초",
      "details": "Google OAuth 로그인과 FastAPI 기반 signup/login/refresh/logout, 토스 결제 승인 prepare/confirm API, ZIP 업로드, 작업 생성 엔드포인트를 TDD로 고정하고 Idempotency-Key 규칙을 도입한다.",
      "target_window": "W1",
      "estimated_hours": 4,
      "status": "pending",
      "dependencies": [
        "PRD 상태 모델과 주요 app_code 목록 정리",
        "FastAPI Router-Service-CRUD-Schema 계층 기본 골격"
      ],
      "risks": [
        "업로드 입력 검증 누락으로 비정상 아카이브가 저장될 위험",
        "멱등 키 처리 미흡으로 중복 과금 또는 중복 작업 생성 위험"
      ],
      "exit_signal": "Google 로그인, 결제 승인, 기존 로그인 모두에서 작업 생성까지 API 호출이 정상 동작하고 입력 오류에서 app_code가 일관되게 반환된다.",
      "acceptance_criteria_mapping": [
        "Auth signup/login/refresh/logout와 POST /auth/google API 골격 완성",
        "POST /auth/google 요청은 {\"id_token\":\"string\"}을 받고 성공 시 access_token, refresh_token, user(id,email,name,avatar_url)를 반환한다.",
        "POST /payments/prepare 요청은 {\"orderId\":\"string\",\"amount\":number,\"orderName\":\"string\",\"customerKey\":\"string\"}을 저장하고 expiresAt을 반환한다.",
        "POST /payments/confirm 요청은 {\"paymentKey\":\"string\",\"orderId\":\"string\",\"amount\":number}으로 토스 승인 API를 호출하고 승인 성공 시 크레딧 원장에 충전 기록을 남긴다.",
        "토스 승인 API 호출에서 Basic 인증 헤더를 사용하고 secret key를 서버 환경 변수로만 관리한다.",
        "Google 플랫폼 라이브러리, google-signin-client_id 메타, g-signin2 버튼, onSignIn 콜백 계획 반영",
        "ID 토큰 검증 후 자체 JWT access/refresh 발급 및 Google 사용자 프로필 매핑 계획 반영",
        "GoogleAuth.signOut() 기반 앱 로그아웃 동작 계획 반영",
        "ZIP 업로드와 jobs 생성이 단일 흐름으로 연결",
        "쓰기 API에 Idempotency-Key 검증 적용"
      ],
      "edge_case_coverage": [
        "UNSUPPORTED_FILE_TYPE",
        "ARCHIVE_PARSE_FAILED",
        "MAX_PAGES_EXCEEDED",
        "IDEMPOTENCY_IN_PROGRESS",
        "GOOGLE_ID_TOKEN_INVALID",
        "GOOGLE_AUTH_EXCHANGE_FAILED",
        "GOOGLE_CLIENT_ID_NOT_CONFIGURED",
        "UNAUTHORIZED_KEY",
        "FORBIDDEN_REQUEST",
        "NOT_FOUND_PAYMENT_SESSION",
        "REJECT_CARD_COMPANY",
        "PAYMENT_AMOUNT_MISMATCH"
      ],
      "checklist": [
        {
          "step": "RED",
          "desc": "test_auth_google_exchanges_valid_id_token, test_auth_google_rejects_invalid_token, test_auth_google_requires_client_id_env, test_payments_prepare_stores_order, test_payments_confirm_rejects_amount_mismatch, test_create_job_requires_idempotency_key를 실패 상태로 고정한다.",
          "done": false
        },
        {
          "step": "GREEN",
          "desc": "POST /auth/google, POST /payments/prepare, POST /payments/confirm, POST /jobs, ZIP 파싱, app_code 매핑을 최소 구현으로 통과시킨다.",
          "done": false
        },
        {
          "step": "REFACTOR",
          "desc": "Google 토큰 검증 어댑터, 결제 승인 서비스, Auth 서비스 경계를 분리하고 예외 처리 코드를 통합한다.",
          "done": false
        }
      ],
      "test_commands": [
        "pytest tests/api/test_auth.py -q",
        "pytest tests/api/test_auth_google.py -q",
        "pytest tests/api/test_payments_prepare.py -q",
        "pytest tests/api/test_payments_confirm.py -q",
        "pytest tests/api/test_jobs_create.py -q"
      ],
      "result_examples": [
        "RED 단계에서 잘못된 Google ID 토큰 교환 요청이 GOOGLE_ID_TOKEN_INVALID를 반환한다.",
        "RED 단계에서 결제 금액 불일치 요청이 PAYMENT_AMOUNT_MISMATCH를 반환한다.",
        "GREEN 단계에서 결제 승인 성공 시 creditedAmount와 credit_ledger 기록이 생성된다.",
        "GREEN 단계에서 유효한 ID 토큰 입력은 access_token과 refresh_token, user payload를 반환한다.",
        "GREEN 단계에서 정상 ZIP 입력은 201과 초기 job_status pending을 반환한다.",
        "REFACTOR 단계에서 테스트 집합 변경 없이 전부 통과한다."
      ],
      "notes": [
        "인증 엔드포인트는 쓰기 API 예외 규칙에 따라 Idempotency-Key 필수 대상에서 제외한다.",
        "google-signin-client_id는 구현 시 NEXT_PUBLIC_GOOGLE_SIGNIN_CLIENT_ID 환경 변수로 주입하는 것을 기본값으로 한다.",
        "백엔드 스키마는 GoogleAuthRequest, GoogleAuthResponse, GoogleUserPayload, PaymentPrepareRequest, PaymentPrepareResponse, PaymentConfirmRequest, PaymentConfirmResponse, TossApproveResponse를 기준으로 정의한다.",
        "결제 환경 변수 키 표준은 TOSS_WIDGET_CLIENT_KEY, TOSS_SECRET_KEY, NEXT_PUBLIC_TOSS_WIDGET_CLIENT_KEY를 사용한다."
      ],
      "quality_gate": {
        "blocking": true,
        "stop_message": "모든 품질 게이트 통과 전 다음 Phase 진행 금지",
        "tdd_compliance": [
          {
            "item": "RED 테스트를 구현 코드보다 먼저 작성했다.",
            "done": false
          },
          {
            "item": "RED 실패 원인을 테스트 명세와 연결해 기록했다.",
            "done": false
          },
          {
            "item": "GREEN 이후 REFACTOR에서 테스트를 변경하지 않았다.",
            "done": false
          }
        ],
        "build_and_tests": [
          {
            "item": "백엔드 관련 테스트 명령이 모두 통과한다.",
            "done": false
          },
          {
            "item": "검증 명령 validate와 check가 통과한다.",
            "done": false
          }
        ],
        "code_quality": [
          {
            "item": "Pydantic 스키마와 타입 선언이 누락되지 않았다.",
            "done": false
          },
          {
            "item": "에러 응답은 HTTP 상태 코드와 app_code를 함께 반환하며 Google 인증 app_code를 포함한다.",
            "done": false
          }
        ],
        "security_and_performance": [
          {
            "item": "민감 정보는 코드에 하드코딩하지 않고 환경 변수로 분리했다.",
            "done": false
          },
          {
            "item": "Google ID 토큰을 서버에서 검증하고 profile.getId()를 백엔드 식별자로 사용하지 않는다.",
            "done": false
          },
          {
            "item": "결제 시크릿 키를 서버에서만 사용하고 Basic 인증 인코딩 값을 클라이언트에 노출하지 않는다.",
            "done": false
          },
          {
            "item": "결제 승인 10분 제한과 amount/orderId 무결성 검증으로 위변조를 차단한다.",
            "done": false
          }
        ],
        "documentation": [
          {
            "item": "API 입력 오류와 app_code 매핑을 문서에 반영했다.",
            "done": false
          },
          {
            "item": "Phase 결과와 남은 이슈를 진행률 추적에 업데이트했다.",
            "done": false
          }
        ],
        "manual_testing": [
          {
            "item": "Google 로그인 성공 후 ZIP 업로드와 작업 생성 수동 경로를 점검했다.",
            "done": false
          },
          {
            "item": "Google 로그아웃(signOut) 이후 보호 경로 재접근 차단을 확인했다.",
            "done": false
          },
          {
            "item": "결제 승인 성공 후 크레딧 충전과 credit_ledger 기록 생성을 수동 검증했다.",
            "done": false
          }
        ],
        "validation_commands": [
          "python scripts/plans_sync.py validate --input Plans.json",
          "python scripts/plans_sync.py check --input Plans.json --output Plans.md"
        ]
      }
    },
    {
      "phase_id": 2,
      "feature": "큐, 워커, 상태 모델 SSOT 고정",
      "details": "Redis 큐와 워커를 연결하고 job_status 및 page_status 전이를 PRD SSOT와 일치시키며 취소와 재시도 규칙을 구현한다.",
      "target_window": "W2",
      "estimated_hours": 4,
      "status": "pending",
      "dependencies": [
        "Phase 1의 작업 생성 API 완료",
        "Redis 연결 구성과 워커 실행 환경 준비"
      ],
      "risks": [
        "상태 전이 불일치로 KPI 집계 기준이 흔들릴 위험",
        "재시도 상한 처리 누락으로 무한 재시도가 발생할 위험"
      ],
      "exit_signal": "작업 취소, 페이지 재시도, 상태 전이가 SSOT에 맞게 동작하고 PAGE_RETRY_LIMIT_EXCEEDED가 일관되게 반환된다.",
      "acceptance_criteria_mapping": [
        "job_status pending, processing, completed, failed, canceled 전이 구현",
        "page_status success, partial, fail, canceled 전이 구현",
        "페이지 재시도 상한 3회 및 취소 규칙 반영"
      ],
      "edge_case_coverage": [
        "ACTIVE_JOB_ALREADY_EXISTS",
        "PAGE_RETRY_LIMIT_EXCEEDED",
        "QUEUE_CAPACITY_EXCEEDED",
        "TEMPORARILY_BLOCKED"
      ],
      "checklist": [
        {
          "step": "RED",
          "desc": "test_active_job_limit_per_user, test_page_retry_limit_three, test_cancel_job_transitions_to_canceled를 먼저 실패시킨다.",
          "done": false
        },
        {
          "step": "GREEN",
          "desc": "큐 enqueue와 dequeue, 취소 및 재시도 API를 최소 구현으로 통과시킨다.",
          "done": false
        },
        {
          "step": "REFACTOR",
          "desc": "상태 전이 로직을 서비스 계층으로 모으고 중복 분기를 제거한다.",
          "done": false
        }
      ],
      "test_commands": [
        "pytest tests/api/test_jobs_status.py -q",
        "pytest tests/api/test_pages_retry.py -q",
        "pytest tests/worker/test_queue_flow.py -q"
      ],
      "result_examples": [
        "RED 단계에서 재시도 4회 요청 테스트가 실패를 명확히 표시한다.",
        "GREEN 단계에서 3회 초과 시 PAGE_RETRY_LIMIT_EXCEEDED를 반환한다.",
        "REFACTOR 단계 이후 상태 전이 테스트와 큐 통합 테스트가 모두 통과한다."
      ],
      "notes": [
        "KPI 집계는 terminal_non_canceled_pages 기준을 기준으로 유지한다."
      ],
      "quality_gate": {
        "blocking": true,
        "stop_message": "모든 품질 게이트 통과 전 다음 Phase 진행 금지",
        "tdd_compliance": [
          {
            "item": "재시도와 취소 규칙의 RED 테스트를 먼저 작성했다.",
            "done": false
          },
          {
            "item": "SSOT 전이 케이스를 테스트 명세에 반영했다.",
            "done": false
          }
        ],
        "build_and_tests": [
          {
            "item": "큐, 워커, 상태 전이 관련 테스트가 통과한다.",
            "done": false
          },
          {
            "item": "문서 동기화 check가 통과한다.",
            "done": false
          }
        ],
        "code_quality": [
          {
            "item": "상태 전이 분기가 단일 서비스 함수로 관리된다.",
            "done": false
          },
          {
            "item": "예외 코드는 PRD app_code 목록과 충돌이 없다.",
            "done": false
          }
        ],
        "security_and_performance": [
          {
            "item": "활성 작업 1건 제한을 서버에서 강제한다.",
            "done": false
          },
          {
            "item": "큐 적체 시 차단 코드 반환으로 과부하를 제어한다.",
            "done": false
          }
        ],
        "documentation": [
          {
            "item": "상태 모델 표를 문서와 구현에서 동일하게 유지한다.",
            "done": false
          },
          {
            "item": "재시도 제한 규칙을 API 설명에 반영한다.",
            "done": false
          }
        ],
        "manual_testing": [
          {
            "item": "작업 취소 후 페이지 상태가 canceled로 고정되는지 점검한다.",
            "done": false
          },
          {
            "item": "재시도 상한 초과 시 UI 메시지가 일관적인지 확인한다.",
            "done": false
          }
        ],
        "validation_commands": [
          "pytest tests/api/test_pages_retry.py -q",
          "python scripts/plans_sync.py validate --input Plans.json"
        ]
      }
    },
    {
      "phase_id": 3,
      "feature": "OCR, 번역, 폴백, Hard Gate 결합",
      "details": "OpenAI를 기본 경로로 사용하고 장애 시 Gemini Vision 폴백을 적용하며 Hard Gate 실패 시 fail-closed로 종료한다.",
      "target_window": "W3",
      "estimated_hours": 4,
      "status": "pending",
      "dependencies": [
        "Phase 2 상태 전이와 워커 파이프라인 연결",
        "외부 AI API 키와 호출 래퍼 준비"
      ],
      "risks": [
        "외부 API 지연으로 페이지 처리 시간이 목표를 초과할 위험",
        "Hard Gate 미적용으로 텍스트 누락 품질 사고가 발생할 위험"
      ],
      "exit_signal": "텍스트 수 보존과 레이아웃 하한 조건을 자동 검증하고 외부 장애 시 폴백 후에도 실패 정책을 유지한다.",
      "acceptance_criteria_mapping": [
        "OCR 결과와 번역 결과 텍스트 개수 일치 검증",
        "OpenAI 장애 시 Gemini Vision 폴백 수행",
        "환율 스냅샷 누락 시 FX_RATE_UNAVAILABLE로 fail-closed"
      ],
      "edge_case_coverage": [
        "FX_RATE_UNAVAILABLE",
        "COST_DAILY_LIMIT_EXCEEDED",
        "HOURLY_PAGE_LIMIT_EXCEEDED",
        "DAILY_PAGE_LIMIT_EXCEEDED"
      ],
      "checklist": [
        {
          "step": "RED",
          "desc": "test_hard_gate_fails_on_text_loss, test_fallback_runs_when_openai_timeout, test_fail_closed_when_fx_rate_missing를 실패 상태로 만든다.",
          "done": false
        },
        {
          "step": "GREEN",
          "desc": "OCR와 번역 파이프라인, Hard Gate 검증, 폴백 분기 최소 구현을 통과시킨다.",
          "done": false
        },
        {
          "step": "REFACTOR",
          "desc": "외부 API 어댑터를 분리하고 타임아웃 및 에러 매핑 중복을 제거한다.",
          "done": false
        }
      ],
      "test_commands": [
        "pytest tests/worker/test_pipeline_hard_gate.py -q",
        "pytest tests/worker/test_fallback_strategy.py -q",
        "pytest tests/api/test_cost_limits.py -q"
      ],
      "result_examples": [
        "RED 단계에서 텍스트 손실 케이스가 Hard Gate 실패로 표시된다.",
        "GREEN 단계에서 OpenAI 타임아웃 시 폴백 호출이 기록된다.",
        "REFACTOR 단계에서 게이트 및 폴백 테스트가 동일하게 통과한다."
      ],
      "notes": [
        "페이지 타임아웃 120초 기준은 워커 설정과 테스트 타임아웃 값에서 함께 관리한다."
      ],
      "quality_gate": {
        "blocking": true,
        "stop_message": "모든 품질 게이트 통과 전 다음 Phase 진행 금지",
        "tdd_compliance": [
          {
            "item": "Hard Gate 실패 케이스를 RED로 먼저 고정했다.",
            "done": false
          },
          {
            "item": "폴백 분기 성공과 실패 시나리오를 모두 테스트에 반영했다.",
            "done": false
          }
        ],
        "build_and_tests": [
          {
            "item": "워커 파이프라인 테스트와 비용 제한 테스트가 통과한다.",
            "done": false
          },
          {
            "item": "문서 검증 명령이 통과한다.",
            "done": false
          }
        ],
        "code_quality": [
          {
            "item": "OpenAI와 Gemini 호출 어댑터 경계를 명확히 분리했다.",
            "done": false
          },
          {
            "item": "게이트 조건식이 테스트 명세와 동일하다.",
            "done": false
          }
        ],
        "security_and_performance": [
          {
            "item": "일일 비용 상한 초과 시 신규 작업 차단이 강제된다.",
            "done": false
          },
          {
            "item": "실패 정책은 fail-closed를 유지한다.",
            "done": false
          }
        ],
        "documentation": [
          {
            "item": "Hard Gate 기준과 폴백 정책을 문서에 반영했다.",
            "done": false
          },
          {
            "item": "비용 및 환율 예외 정책을 운영 섹션에 정리했다.",
            "done": false
          }
        ],
        "manual_testing": [
          {
            "item": "외부 API 장애를 가정한 수동 폴백 점검을 수행한다.",
            "done": false
          },
          {
            "item": "게이트 실패 시 사용자 노출 메시지를 검토한다.",
            "done": false
          }
        ],
        "validation_commands": [
          "pytest tests/worker/test_pipeline_hard_gate.py -q",
          "python scripts/plans_sync.py validate --input Plans.json"
        ]
      }
    },
    {
      "phase_id": 4,
      "feature": "인페인팅, 식자, 페이지 편집 및 재시도 고도화",
      "details": "레이아웃 품질을 보장하는 식자 규칙과 페이지 편집 가능 조건을 확정하고 실패 페이지 재시도 흐름을 안정화한다.",
      "target_window": "W4",
      "estimated_hours": 4,
      "status": "pending",
      "dependencies": [
        "Phase 3의 OCR, 번역 결과 데이터 구조",
        "페이지 단위 결과 저장과 다운로드 경로"
      ],
      "risks": [
        "폰트 크기와 말풍선 넘침 조건 위반으로 읽기 품질이 떨어질 위험",
        "편집 가능 상태 검증 누락으로 PAGE_NOT_EDITABLE 위반이 발생할 위험"
      ],
      "exit_signal": "bbox_overflow와 min_font_pt 조건을 만족하고 편집 제한 규칙이 서버와 UI에서 동일하게 동작한다.",
      "acceptance_criteria_mapping": [
        "레이아웃 게이트에서 bbox_overflow 0 유지",
        "최소 폰트 크기 10pt 이상 유지",
        "편집 불가 상태에서 PAGE_NOT_EDITABLE 강제"
      ],
      "edge_case_coverage": [
        "PAGE_NOT_EDITABLE",
        "PAGE_RETRY_LIMIT_EXCEEDED",
        "ARCHIVE_PARSE_FAILED",
        "TEMPORARILY_BLOCKED"
      ],
      "checklist": [
        {
          "step": "RED",
          "desc": "test_layout_gate_rejects_overflow, test_layout_gate_rejects_too_small_font, test_page_edit_blocked_when_not_editable를 실패로 고정한다.",
          "done": false
        },
        {
          "step": "GREEN",
          "desc": "식자 규칙과 편집 제한 분기를 최소 구현으로 통과시킨다.",
          "done": false
        },
        {
          "step": "REFACTOR",
          "desc": "식자 파라미터와 페이지 상태 검사 코드를 분리해 유지보수성을 높인다.",
          "done": false
        }
      ],
      "test_commands": [
        "pytest tests/api/test_pages_edit.py -q",
        "pytest tests/worker/test_typesetting_gate.py -q"
      ],
      "result_examples": [
        "RED 단계에서 폰트 9pt 입력 케이스가 실패한다.",
        "GREEN 단계에서 편집 불가 페이지는 PAGE_NOT_EDITABLE을 반환한다.",
        "REFACTOR 단계에서 레이아웃 게이트 테스트가 동일하게 통과한다."
      ],
      "notes": [
        "식자 품질은 샘플링 평가를 병행해 Soft Gate와 연결한다."
      ],
      "quality_gate": {
        "blocking": true,
        "stop_message": "모든 품질 게이트 통과 전 다음 Phase 진행 금지",
        "tdd_compliance": [
          {
            "item": "레이아웃 실패와 편집 제한 케이스를 RED로 먼저 작성했다.",
            "done": false
          },
          {
            "item": "게이트 조건 경계값 테스트를 포함했다.",
            "done": false
          }
        ],
        "build_and_tests": [
          {
            "item": "식자 게이트와 페이지 편집 테스트가 통과한다.",
            "done": false
          },
          {
            "item": "문서 동기화 check가 통과한다.",
            "done": false
          }
        ],
        "code_quality": [
          {
            "item": "레이아웃 계산 로직의 책임 경계를 분리했다.",
            "done": false
          },
          {
            "item": "오류 코드와 메시지 매핑을 중앙화했다.",
            "done": false
          }
        ],
        "security_and_performance": [
          {
            "item": "페이지 재시도 상한 3회 규칙을 서버에서 강제한다.",
            "done": false
          },
          {
            "item": "과도한 편집 요청에 대한 제한 정책을 검토한다.",
            "done": false
          }
        ],
        "documentation": [
          {
            "item": "레이아웃 게이트 기준과 편집 제한 규칙을 문서화한다.",
            "done": false
          },
          {
            "item": "페이지 상태별 재시도 정책을 운영 가이드에 반영한다.",
            "done": false
          }
        ],
        "manual_testing": [
          {
            "item": "완료된 페이지와 실패 페이지 편집 동작을 수동 점검한다.",
            "done": false
          },
          {
            "item": "다양한 해상도 샘플에서 말풍선 넘침 여부를 확인한다.",
            "done": false
          }
        ],
        "validation_commands": [
          "pytest tests/api/test_pages_edit.py -q",
          "python scripts/plans_sync.py validate --input Plans.json"
        ]
      }
    },
    {
      "phase_id": 5,
      "feature": "Next.js 사용자 여정, Google 로그인 UI, 결제위젯, 오류 매핑 통합",
      "details": "Google 로그인 UI, 토스 결제위젯 UI, 업로드, 진행률 조회, 결과 다운로드, 페이지 편집, 신고 생성까지 프론트 사용자 여정을 통합하고 app_code 기반 오류 표시를 표준화한다.",
      "target_window": "W5",
      "estimated_hours": 4,
      "status": "pending",
      "dependencies": [
        "Phase 1부터 Phase 4까지 API 계약 안정화",
        "Frontend App Router 기본 구조와 상태 관리 전략"
      ],
      "risks": [
        "UI와 API 오류 코드 매핑 불일치로 사용자 혼란이 발생할 위험",
        "진행률 및 상태 표시 지연으로 체감 품질이 저하될 위험"
      ],
      "exit_signal": "핵심 사용자 여정에서 업로드부터 다운로드까지 단절 없이 동작하고 오류 메시지가 app_code 기준으로 일관되게 노출된다.",
      "acceptance_criteria_mapping": [
        "로그인 페이지에 <script src=\"https://apis.google.com/js/platform.js\" async defer></script>를 반영한다.",
        "로그인 페이지에 <meta name=\"google-signin-client_id\" content=\"455519487200-7liplou3k773k5sc5539fpk4fedk6am2.apps.googleusercontent.com\">를 반영한다.",
        "g-signin2 버튼과 onSignIn 콜백에서 프로필 표시와 ID 토큰 교환 흐름을 연결한다.",
        "signOut 함수에서 gapi.auth2.getAuthInstance().signOut() 호출을 반영한다.",
        "결제 페이지에 <script src=\"https://js.tosspayments.com/v2/standard\"></script> 또는 @tosspayments/tosspayments-sdk 초기화를 반영한다.",
        "TossPayments(clientKey) 초기화 후 widgets({ customerKey }) 인스턴스를 생성한다.",
        "renderPaymentMethods와 renderAgreement를 비동기(await)로 완료한 뒤 결제 버튼을 활성화한다.",
        "쿠폰 등 금액 변경 시 widgets.setAmount({ currency: \"KRW\", value }) 호출로 결제 금액을 동기화한다.",
        "successUrl과 failUrl 리다이렉트 파라미터(paymentKey, orderId, amount, code, message)를 처리한다.",
        "업로드 화면에서 파일 검증과 진행률 표시 구현",
        "작업 상세에서 페이지 상태와 재시도 동작 구현",
        "오류 코드별 사용자 안내 문구 표준화"
      ],
      "edge_case_coverage": [
        "QUEUE_CAPACITY_EXCEEDED",
        "ACTIVE_JOB_ALREADY_EXISTS",
        "UNSUPPORTED_FILE_TYPE",
        "PAGE_NOT_EDITABLE",
        "GOOGLE_ID_TOKEN_INVALID",
        "GOOGLE_AUTH_EXCHANGE_FAILED",
        "GOOGLE_LOGIN_CANCELED",
        "GOOGLE_EMAIL_SCOPE_MISSING",
        "UNAUTHORIZED_KEY",
        "NOT_REGISTERED_PAYMENT_WIDGET"
      ],
      "checklist": [
        {
          "step": "RED",
          "desc": "google-login.spec, payment-widget.spec, payment-success-page.spec, payment-fail-page.spec, upload.spec, job-detail.spec, error-map.spec를 먼저 작성하고 실패 상태를 확인한다.",
          "done": false
        },
        {
          "step": "GREEN",
          "desc": "Google 로그인 UI, 결제위젯 UI, 업로드, 상세, 오류 안내 화면을 최소 구현으로 연결한다.",
          "done": false
        },
        {
          "step": "REFACTOR",
          "desc": "React Query 중심으로 서버 상태를 분리하고 Google/결제위젯 타입 경계와 컴포넌트 책임을 정리한다.",
          "done": false
        }
      ],
      "test_commands": [
        "npm run test -- src/features/auth/google-login.spec.ts",
        "npm run test -- src/features/payments/payment-widget.spec.ts",
        "npm run test -- src/features/payments/payment-success-page.spec.ts",
        "npm run test -- src/features/payments/payment-fail-page.spec.ts",
        "npm run test -- src/features/upload/upload.spec.ts",
        "npm run test -- src/features/jobs/job-detail.spec.ts",
        "npm run test -- src/features/errors/error-map.spec.ts"
      ],
      "result_examples": [
        "RED 단계에서 오류 코드 매핑 누락 테스트가 실패한다.",
        "GREEN 단계에서 결제위젯 비동기 렌더링 완료(await) 이후 결제 버튼이 활성화된다.",
        "GREEN 단계에서 successUrl 파라미터 처리 후 confirm API 호출이 수행된다.",
        "GREEN 단계에서 app_code별 안내 문구가 화면에 표시된다.",
        "REFACTOR 단계에서 상태 관리 코드 중복이 줄어든다."
      ],
      "notes": [
        "Frontend는 any 사용 금지 규칙을 유지하고 타입 경계를 명확히 한다.",
        "window.gapi, GoogleUser, BasicProfile, AuthResponse 글로벌 타입 선언을 프론트 인증 모듈 기준으로 정의한다.",
        "TossPaymentsInstance, TossPaymentsWidgets, RequestPaymentParams, PaymentRedirectSuccessQuery, PaymentRedirectFailQuery 타입 선언을 결제 모듈 기준으로 정의한다."
      ],
      "quality_gate": {
        "blocking": true,
        "stop_message": "모든 품질 게이트 통과 전 다음 Phase 진행 금지",
        "tdd_compliance": [
          {
            "item": "UI 단위 테스트를 기능 구현보다 먼저 작성했다.",
            "done": false
          },
          {
            "item": "오류 매핑 케이스를 RED에 포함했다.",
            "done": false
          }
        ],
        "build_and_tests": [
          {
            "item": "Frontend 단위 테스트 명령이 통과한다.",
            "done": false
          },
          {
            "item": "문서 validate와 check가 통과한다.",
            "done": false
          }
        ],
        "code_quality": [
          {
            "item": "컴포넌트는 함수형 패턴과 Hook 규칙을 준수한다.",
            "done": false
          },
          {
            "item": "window.gapi, GoogleUser, BasicProfile, AuthResponse 타입 선언에서 any를 사용하지 않는다.",
            "done": false
          },
          {
            "item": "TossPayments/widgets 관련 타입 선언에서 any를 사용하지 않는다.",
            "done": false
          }
        ],
        "security_and_performance": [
          {
            "item": "클라이언트에 민감 정보가 노출되지 않도록 점검하고 클라이언트 ID를 환경 변수로 주입한다.",
            "done": false
          },
          {
            "item": "결제 시크릿 키는 프론트로 전달하지 않고 결제위젯 클라이언트 키만 노출한다.",
            "done": false
          },
          {
            "item": "장시간 폴링 또는 과도한 재요청을 방지한다.",
            "done": false
          }
        ],
        "documentation": [
          {
            "item": "오류 코드별 UI 대응표를 문서로 유지한다.",
            "done": false
          },
          {
            "item": "사용자 여정 스크린 단위 설명을 업데이트한다.",
            "done": false
          }
        ],
        "manual_testing": [
          {
            "item": "Google 로그인부터 결제위젯 진입, 업로드-다운로드까지 브라우저 수동 경로를 점검한다.",
            "done": false
          },
          {
            "item": "결제 성공 리다이렉트(paymentKey/orderId/amount) 처리와 실패 리다이렉트(code/message) 안내 문구를 확인한다.",
            "done": false
          },
          {
            "item": "Google 로그아웃 후 세션 해제와 대표 오류 코드 안내 문구를 확인한다.",
            "done": false
          }
        ],
        "validation_commands": [
          "npm run test -- src/features/upload/upload.spec.ts",
          "python scripts/plans_sync.py check --input Plans.json --output Plans.md"
        ]
      }
    },
    {
      "phase_id": 6,
      "feature": "E2E, KPI, Go 또는 No-Go 판정",
      "details": "Playwright 기반 사용자 여정 E2E와 KPI 집계를 연결해 Hard Gate, Soft Gate, 사용자 Gate를 최종 점검하고 MVP 출시 여부를 판단한다.",
      "target_window": "W6",
      "estimated_hours": 4,
      "status": "pending",
      "dependencies": [
        "Phase 1부터 Phase 5까지 기능 통합 완료",
        "KPI 산출 데이터와 cohort_100 샘플 정의"
      ],
      "risks": [
        "플레이키 E2E로 출시 판단 근거가 흔들릴 위험",
        "KPI 계산 기준 불일치로 Go 판정이 왜곡될 위험"
      ],
      "exit_signal": "E2E 사용자 여정이 통과하고 Hard Gate, Soft Gate, 사용자 Gate 지표가 PRD 기준을 충족한다.",
      "acceptance_criteria_mapping": [
        "업로드, 처리, 다운로드, 편집, 신고 경로 E2E 통과",
        "결제→승인→크레딧 반영→작업 생성 가능 경로 E2E 통과",
        "successUrl의 paymentType 값(NORMAL, BRANDPAY) 파싱 및 분기 처리 검증",
        "success_rate와 usable_rate 계산 기준 검증",
        "CSAT과 무편집 읽기 비율 기준 충족 여부 판정"
      ],
      "edge_case_coverage": [
        "QUEUE_CAPACITY_EXCEEDED",
        "COST_DAILY_LIMIT_EXCEEDED",
        "FX_RATE_UNAVAILABLE",
        "TEMPORARILY_BLOCKED",
        "PAYMENT_AMOUNT_MISMATCH",
        "NOT_FOUND_PAYMENT_SESSION",
        "UNSUPPORTED_PAYMENT_TYPE"
      ],
      "checklist": [
        {
          "step": "RED",
          "desc": "user-journey.e2e, payment-credit-topup.e2e, metrics.test, moderation.test를 먼저 작성하고 실패를 확인한다.",
          "done": false
        },
        {
          "step": "GREEN",
          "desc": "E2E 자동화, 결제 성공/실패 리다이렉트 경로, KPI 집계 코드를 최소 구현으로 통과시킨다.",
          "done": false
        },
        {
          "step": "REFACTOR",
          "desc": "플레이키 완화 전략, 결제 테스트 픽스처 분리, 지표 계산 모듈 분리를 반영한다.",
          "done": false
        }
      ],
      "test_commands": [
        "npm run test:e2e -- tests/e2e/user-journey.spec.ts",
        "npm run test:e2e -- tests/e2e/payment-credit-topup.spec.ts",
        "pytest tests/integration/test_metrics_kpi.py -q",
        "pytest tests/integration/test_moderation_flow.py -q"
      ],
      "result_examples": [
        "RED 단계에서 KPI 임계 미달 케이스가 실패한다.",
        "GREEN 단계에서 결제 승인 성공 후 크레딧 증가와 작업 생성 가능 상태를 확인한다.",
        "GREEN 단계에서 핵심 여정 E2E가 통과하고 지표 계산 값이 생성된다.",
        "REFACTOR 단계에서 flaky 케이스 재현 빈도가 낮아진다."
      ],
      "notes": [
        "최종 Go 또는 No-Go 판단은 지표와 품질 게이트 통과 기록을 근거로 문서화한다.",
        "플레이키 완화를 위해 테스트 결제 키와 고정 order fixture를 E2E 데이터로 사용한다."
      ],
      "quality_gate": {
        "blocking": true,
        "stop_message": "모든 품질 게이트 통과 전 다음 Phase 진행 금지",
        "tdd_compliance": [
          {
            "item": "E2E와 KPI 테스트를 구현 전에 RED로 작성했다.",
            "done": false
          },
          {
            "item": "게이트 기준을 테스트와 문서에서 동일하게 유지한다.",
            "done": false
          }
        ],
        "build_and_tests": [
          {
            "item": "E2E와 통합 KPI 테스트 명령이 통과한다.",
            "done": false
          },
          {
            "item": "문서 동기화와 검증 명령이 통과한다.",
            "done": false
          },
          {
            "item": "결제 관련 E2E(payment-credit-topup) 테스트가 통과한다.",
            "done": false
          }
        ],
        "code_quality": [
          {
            "item": "KPI 계산식은 PRD 정의와 동일한 수식을 사용한다.",
            "done": false
          },
          {
            "item": "테스트 데이터 생성 코드의 중복을 줄인다.",
            "done": false
          }
        ],
        "security_and_performance": [
          {
            "item": "콘텐츠 정책 위반 신고 흐름을 E2E에서 점검한다.",
            "done": false
          },
          {
            "item": "페이지당 평균 처리 시간과 타임아웃 지표를 함께 검토한다.",
            "done": false
          }
        ],
        "documentation": [
          {
            "item": "Go 또는 No-Go 판정 근거를 문서로 남긴다.",
            "done": false
          },
          {
            "item": "학습 사항과 차기 개선 과제를 기록한다.",
            "done": false
          }
        ],
        "manual_testing": [
          {
            "item": "샘플 계정으로 결제 승인 후 크레딧 반영과 작업 생성 가능 상태를 수동 검증한다.",
            "done": false
          },
          {
            "item": "관리자 신고 처리 흐름을 수동으로 점검한다.",
            "done": false
          }
        ],
        "validation_commands": [
          "npm run test:e2e -- tests/e2e/user-journey.spec.ts",
          "python scripts/plans_sync.py validate --input Plans.json"
        ]
      }
    }
  ],
  "4_Decision_Log": [
    {
      "decision": "로드맵 문서의 단일 원본은 Plans.json으로 고정한다.",
      "reason": "기계 편집 안정성을 확보하고 Plans.md를 항상 결정론적으로 생성하기 위함이다."
    },
    {
      "decision": "문서 성격은 즉시 실행 체크리스트가 아닌 6주 미래 구현 로드맵으로 유지한다.",
      "reason": "현재 저장소 단계에서는 실행 지시보다 단계 목표와 의존성, 게이트 관리가 우선이다."
    },
    {
      "decision": "테스트 명령 정책은 example_only를 유지한다.",
      "reason": "구현 이전 단계에서 파일 경로가 변동될 수 있어 명령은 예시로 관리하는 편이 현실적이다."
    },
    {
      "decision": "Hard Gate 실패는 fail-closed를 기본 정책으로 채택한다.",
      "reason": "품질 미달 결과를 사용자에게 노출하지 않기 위해 보수적 실패 정책이 필요하다."
    },
    {
      "decision": "외부 AI 경로는 OpenAI 기본, Gemini Vision 폴백으로 고정한다.",
      "reason": "AGENTS.md 스택 강제 사항과 PRD 내결함성 요구를 동시에 만족한다."
    },
    {
      "decision": "MVP Google 로그인 경로는 platform.js + g-signin2를 사용한다.",
      "reason": "사용자 요구사항의 스니펫을 정확히 반영하고 초기 통합 속도를 확보하기 위함이다."
    },
    {
      "decision": "백엔드는 Google ID 토큰 검증 후 자체 JWT를 발급한다.",
      "reason": "세션 관리 일관성과 보안 정책을 유지하기 위함이다."
    },
    {
      "decision": "토스페이먼츠 결제위젯은 v2를 MVP 기준으로 고정한다.",
      "reason": "사용자 제공 가이드를 기준으로 빠르게 결제 통합을 완료하기 위함이다."
    },
    {
      "decision": "결제 API 계약은 POST /payments/prepare + POST /payments/confirm 분리 구조로 고정한다.",
      "reason": "결제 요청과 승인 사이 무결성 검증을 명확히 하고 리다이렉트 흐름을 안정화하기 위함이다."
    },
    {
      "decision": "결제 승인 성공 시 비즈니스 반영은 크레딧 충전으로 고정한다.",
      "reason": "PRD의 크레딧 원장 모델과 일관된 결제 후 처리 기준을 유지하기 위함이다."
    },
    {
      "decision": "웹훅 및 결제 조회/취소 API는 MVP 후속 범위로 분리한다.",
      "reason": "6주 로드맵에서 핵심 결제 성공 경로와 무결성 보장을 우선하기 위함이다."
    },
    {
      "decision": "Top 8 리스크 즉시 대응은 문서/정책 전용 범위로 실행한다.",
      "reason": "현재 저장소가 문서 중심이므로 코드 구현 이전에 운영 규칙과 검증 명령을 SSOT에 고정하기 위함이다."
    },
    {
      "decision": "Top 8 리스크는 묶음 병행 방식으로 운영한다.",
      "reason": "재현성, 외부 API 가용성, 인증/결제, 큐/경합, 테스트 게이트를 분리하면 우선순위 충돌 없이 즉시 통제가 가능하다."
    },
    {
      "decision": "Top 8 최소 테스트 게이트(Auth/Payment/Fallback/Queue/app_code)를 차단형 규칙으로 강제한다.",
      "reason": "품질 게이트가 문서상 선언에만 머무르지 않도록 최소 검증 단위를 즉시 대응 기준으로 고정하기 위함이다."
    },
    {
      "decision": "Top 8 검증은 rg 기반 키워드 점검과 plans_sync 동기화 검증을 함께 수행한다.",
      "reason": "AGENTS, PRD, 리스크 레지스터, Plans 간 용어 드리프트를 조기에 차단하기 위함이다."
    },
    {
      "decision": "프로젝트 라이선스는 MIT로 고정하고 LICENSE/NOTICE를 배포 필수 산출물로 유지한다.",
      "reason": "오픈소스 사용 고지 의무를 충족하고 컴플라이언스 검증 기준을 명확히 하기 위함이다."
    },
    {
      "decision": "SBOM 산출물은 SPDX JSON과 CycloneDX JSON을 병행 유지한다.",
      "reason": "내부 점검과 외부 제출 포맷을 동시에 충족하고 추적성을 높이기 위함이다."
    },
    {
      "decision": "의존성 버전 정책은 exact 고정으로 운영한다.",
      "reason": "환경별 재현성 드리프트를 줄이고 릴리즈 회귀 분석을 단순화하기 위함이다."
    },
    {
      "decision": "3차 우선순위는 컴플라이언스 전용 Top 8(C-01~C-08)으로 재구성한다.",
      "reason": "문서/증빙 기반 차단 이슈를 우선 해소해 오픈소스 사용 판정을 가능 상태로 전환하기 위함이다."
    },
    {
      "decision": "문서/검증 범위 100% 판정은 차단 이슈 0건 + DR Open 0건 + CI 강제 검증 통과를 동시에 만족해야 한다.",
      "reason": "절대 무고장 대신 검증 가능한 보장 범위를 명확히 정의해 운영 해석 오차를 제거하기 위함이다."
    },
    {
      "decision": "DR-07은 외부 SDK 정책 문서 해시 자동 감시를 도입해 Closed로 관리한다.",
      "reason": "Google/Toss/OpenAI 정책 변화 리스크를 수동 확인이 아닌 주기적 자동 감시로 통제하기 위함이다."
    },
    {
      "decision": "외부 SDK 정책 변화 감시는 daily 스케줄 + 수동 실행(workflow_dispatch)으로 운영한다.",
      "reason": "일일 감시로 빠른 탐지를 확보하고 필요 시 즉시 재검증할 수 있도록 하기 위함이다."
    }
  ],
  "5_Validation": [
    "python scripts/plans_sync.py validate --input Plans.json",
    "python scripts/plans_sync.py render --input Plans.json --output Plans.md",
    "python scripts/plans_sync.py check --input Plans.json --output Plans.md",
    "rg -n \"\\?{2,}\" Plans.json Plans.md",
    "rg -n \"payment-widget-sdk|PaymentWidget\\(|updateAmount\\(|ready 이벤트\" Plans.json Plans.md",
    "rg -n \"GOOGLE_ID_TOKEN_INVALID|GOOGLE_AUTH_EXCHANGE_FAILED|PAYMENT_AMOUNT_MISMATCH|NOT_FOUND_PAYMENT_SESSION|UNAUTHORIZED_KEY|FORBIDDEN_REQUEST|NOT_REGISTERED_PAYMENT_WIDGET|IDEMPOTENCY_IN_PROGRESS|FX_RATE_UNAVAILABLE\" AGENTS.md docs/specs/PRD.md Plans.md",
    "rg -n \"C-01|C-02|C-03|C-04|C-05|C-06|C-07|C-08\" docs/specs/OSS_EXTERNAL_DEPENDENCY_RISK_REGISTER.md",
    "rg -n \"Idempotency-Key|fail-closed|fallback_rate|OSS 컴플라이언스 최소 게이트\" AGENTS.md docs/specs/PRD.md Plans.md",
    "python scripts/compliance_gate.py",
    "python scripts/sdk_policy_watch.py --watchlist docs/compliance/external_sdk_watchlist.json --snapshot docs/compliance/external_sdk_snapshot.json --strict",
    "powershell -Command \"Test-Path LICENSE; Test-Path NOTICE; Test-Path package.json; Test-Path package-lock.json; Test-Path requirements.txt; Test-Path requirements-dev.txt; Test-Path docs/compliance/OSS_LICENSE_POLICY.md; Test-Path docs/compliance/DEPENDENCY_VERSION_MATRIX.md; Test-Path docs/compliance/THIRD_PARTY_NOTICES.md; Test-Path docs/compliance/SBOM.spdx.json; Test-Path docs/compliance/SBOM.cyclonedx.json\"",
    "rg -n \"MIT|Apache-2.0|LGPL|BSD-3-Clause\" docs/compliance/DEPENDENCY_VERSION_MATRIX.md docs/compliance/THIRD_PARTY_NOTICES.md"
  ],
  "6_Risk_Assessment": [
    {
      "risk": "의존성 매니페스트와 락파일 부재로 환경별 재현성이 깨질 수 있다.",
      "probability": "high",
      "impact": "high",
      "mitigation_strategy": "frontend/backend 매니페스트 표준과 버전 고정 정책을 문서에 고정하고 plans_sync + 키워드 검증 명령을 릴리즈 게이트로 강제한다."
    },
    {
      "risk": "업로드 입력 검증이 약해 비정상 파일이 파이프라인을 오염시킬 수 있다.",
      "probability": "medium",
      "impact": "high",
      "mitigation_strategy": "Phase 1에서 파일 형식, 압축 구조, 페이지 수 상한 검증 테스트를 RED로 먼저 고정한다."
    },
    {
      "risk": "상태 전이 불일치로 과금과 KPI 집계가 틀어질 수 있다.",
      "probability": "high",
      "impact": "high",
      "mitigation_strategy": "job_status/page_status 전이와 함께 Idempotency-Key 경합, 중복 소비 방지, 재시도 상한(PAGE_RETRY_LIMIT_EXCEEDED) 규칙을 묶어서 SSOT 준수를 강제한다."
    },
    {
      "risk": "외부 AI API 장애로 처리 지연 또는 실패율 급증이 발생할 수 있다.",
      "probability": "medium",
      "impact": "high",
      "mitigation_strategy": "공급자별 타임아웃/재시도/서킷브레이커를 분리 운영하고 fallback_rate와 처리시간 p95를 운영 지표로 강제한다."
    },
    {
      "risk": "최소 테스트 게이트가 미구현 상태로 남아 품질 게이트가 선언에만 머무를 수 있다.",
      "probability": "high",
      "impact": "high",
      "mitigation_strategy": "Auth, Payment, Fallback, Queue, app_code 매핑 회귀를 Top 8 최소 테스트 게이트로 문서에 고정하고 미충족 시 다음 Phase 진행을 차단한다."
    },
    {
      "risk": "레이아웃 품질 게이트 누락으로 읽기 경험이 저하될 수 있다.",
      "probability": "medium",
      "impact": "high",
      "mitigation_strategy": "Phase 4에서 bbox_overflow와 min_font_pt 경계값 테스트를 의무화한다."
    },
    {
      "risk": "UI 오류 코드 매핑 누락으로 사용자 안내가 부정확해질 수 있다.",
      "probability": "medium",
      "impact": "medium",
      "mitigation_strategy": "Phase 5에서 오류 매핑 단위 테스트를 추가하고 app_code 대응표를 유지한다."
    },
    {
      "risk": "플레이키 E2E로 출시 의사결정 신뢰도가 떨어질 수 있다.",
      "probability": "high",
      "impact": "medium",
      "mitigation_strategy": "Phase 6에서 데이터 고정 샘플과 재시도 정책을 분리해 flaky 원인을 통제한다."
    },
    {
      "risk": "일일 비용 상한 관리 실패로 운영 비용이 급증할 수 있다.",
      "probability": "medium",
      "impact": "high",
      "mitigation_strategy": "비용 이벤트 원장과 환율 스냅샷 이상 신호를 함께 감시하고 COST_DAILY_LIMIT_EXCEEDED 또는 FX_RATE_UNAVAILABLE 발생 시 fail-closed와 운영 알림을 강제한다."
    },
    {
      "risk": "문서 동기화 누락으로 팀 해석이 분산될 수 있다.",
      "probability": "low",
      "impact": "medium",
      "mitigation_strategy": "CI에서 validate와 check를 강제해 Plans.json과 Plans.md의 드리프트를 차단한다."
    },
    {
      "risk": "Google 외부 스크립트 또는 ID 토큰 검증 실패로 로그인 장애가 발생할 수 있다.",
      "probability": "medium",
      "impact": "high",
      "mitigation_strategy": "GOOGLE_ID_TOKEN_INVALID, GOOGLE_AUTH_EXCHANGE_FAILED, GOOGLE_CLIENT_ID_NOT_CONFIGURED를 표준 app_code로 노출하고 대체 로그인 경로를 즉시 우선 노출한다."
    },
    {
      "risk": "토스 API 키 불일치 또는 시크릿 키 인코딩 오류로 결제 승인에 실패할 수 있다.",
      "probability": "medium",
      "impact": "high",
      "mitigation_strategy": "UNAUTHORIZED_KEY, FORBIDDEN_REQUEST, NOT_REGISTERED_PAYMENT_WIDGET를 표준 app_code로 매핑하고 위젯 렌더 완료 전 결제 버튼 비활성을 강제한다."
    },
    {
      "risk": "리다이렉트 URL 파라미터 금액 변조로 결제 무결성이 훼손될 수 있다.",
      "probability": "medium",
      "impact": "high",
      "mitigation_strategy": "prepare 저장 amount/orderId와 successUrl 파라미터를 비교해 PAYMENT_AMOUNT_MISMATCH 시 승인 차단한다."
    },
    {
      "risk": "결제 요청 후 승인 지연(10분 초과)으로 세션 만료가 발생할 수 있다.",
      "probability": "medium",
      "impact": "medium",
      "mitigation_strategy": "NOT_FOUND_PAYMENT_SESSION 처리와 사용자 재시도 동선, 만료 안내 메시지를 표준화한다."
    },
    {
      "risk": "결제위젯 미등록 또는 선택자 오류로 결제 UI가 렌더링되지 않을 수 있다.",
      "probability": "low",
      "impact": "medium",
      "mitigation_strategy": "UNAUTHORIZED_KEY, NOT_REGISTERED_PAYMENT_WIDGET 오류를 감지하고 비동기 렌더링 완료(await) 기반 버튼 활성화 규칙을 강제한다."
    },
    {
      "risk": "LICENSE, NOTICE, SBOM 산출물이 누락되면 배포 컴플라이언스가 무효화될 수 있다.",
      "probability": "medium",
      "impact": "high",
      "mitigation_strategy": "컴플라이언스 최소 게이트로 파일 존재성 검증을 차단형으로 운영하고 누락 시 릴리즈를 중단한다."
    },
    {
      "risk": "금지 라이선스(GPL, AGPL, SSPL) 의존성이 유입될 수 있다.",
      "probability": "low",
      "impact": "high",
      "mitigation_strategy": "OSS 라이선스 정책에서 금지군을 명시하고 의존성 추가 시 사전 승인을 필수화한다."
    },
    {
      "risk": "조건부 라이선스(LGPL) 항목의 고지/사용 조건 관리가 누락될 수 있다.",
      "probability": "medium",
      "impact": "medium",
      "mitigation_strategy": "DEPENDENCY_VERSION_MATRIX와 THIRD_PARTY_NOTICES에 조건부 허용 사유를 고정하고 배포 시 함께 검증한다."
    },
    {
      "risk": "외부 SDK 정책 문서 변경을 늦게 감지하면 로그인/결제/AI 연동 가이드가 빠르게 구식이 될 수 있다.",
      "probability": "medium",
      "impact": "high",
      "mitigation_strategy": "external_sdk_watchlist/snapshot 기반 해시 감시와 external-sdk-watch 워크플로를 daily로 운영하고 변화 감지 시 fail-closed로 차단한다."
    }
  ],
  "7_Rollback_Strategy": {
    "phase_rollbacks": [
      {
        "phase_id": 1,
        "trigger": "Google 인증 실패율 급증, 결제 승인 실패율 급증, 또는 인증/업로드 API에서 잘못된 app_code가 반복적으로 반환된다.",
        "steps": [
          "Google 로그인 경로를 임시 비활성화하고 기존 signup/login 경로를 우선 유지한다.",
          "결제 진입 차단 플래그를 활성화하고 결제위젯 노출을 중단한다.",
          "작업 생성 API 변경분을 임시 비활성화한다.",
          "이전 안정 입력 검증 규칙으로 되돌린다.",
          "Google 인증 app_code와 서버 로그를 기준으로 원인을 복구한다.",
          "결제 관련 app_code와 승인 로그를 기준으로 키/인코딩/금액 무결성 문제를 복구한다.",
          "결제 비활성화 동안 기존 크레딧 소모 경로를 유지한다.",
          "RED 테스트를 재실행해 실패 원인을 다시 고정한다."
        ],
        "restore_target": "Phase 1 시작 전 API 계약 상태"
      },
      {
        "phase_id": 2,
        "trigger": "상태 전이 불일치 또는 큐 적체로 작업 취소가 불가능해진다.",
        "steps": [
          "워커 동시성을 낮추고 신규 큐 입력을 제한한다.",
          "상태 전이 로직을 직전 안정 커밋으로 복구한다.",
          "재시도 상한 테스트를 다시 통과시킨다."
        ],
        "restore_target": "Phase 1 완료 상태"
      },
      {
        "phase_id": 3,
        "trigger": "폴백 경로가 오작동해 Hard Gate 실패 데이터가 노출된다.",
        "steps": [
          "폴백 경로를 임시 차단하고 기본 경로만 허용한다.",
          "Hard Gate 검증 실패 시 즉시 failed 종료를 강제한다.",
          "비용 및 환율 실패 정책 테스트를 재실행한다."
        ],
        "restore_target": "Phase 2 완료 상태"
      },
      {
        "phase_id": 4,
        "trigger": "식자 품질 게이트가 무력화되어 레이아웃 오류가 증가한다.",
        "steps": [
          "편집 기능을 읽기 전용으로 임시 전환한다.",
          "식자 파라미터를 직전 안정 설정으로 롤백한다.",
          "레이아웃 경계값 테스트 통과 후 기능을 재개한다."
        ],
        "restore_target": "Phase 3 완료 상태"
      },
      {
        "phase_id": 5,
        "trigger": "프론트 화면에서 오류 코드 안내가 잘못 표시된다.",
        "steps": [
          "오류 매핑 테이블을 직전 릴리스 버전으로 복구한다.",
          "핵심 업로드와 상세 화면만 우선 노출한다.",
          "오류 매핑 테스트 통과 후 전체 화면을 재개한다."
        ],
        "restore_target": "Phase 4 완료 상태"
      },
      {
        "phase_id": 6,
        "trigger": "KPI 집계 오류 또는 E2E 불안정으로 Go 판정이 불가능하다.",
        "steps": [
          "출시 판정을 보류하고 기존 안정 버전을 유지한다.",
          "KPI 집계 입력 데이터와 계산식을 재검증한다.",
          "플레이키 케이스를 분리한 뒤 E2E를 재실행한다."
        ],
        "restore_target": "Phase 5 완료 상태"
      }
    ]
  },
  "8_Progress_Tracking": {
    "phase_status": [
      {
        "phase_id": 1,
        "status": "pending",
        "progress_percent": 0
      },
      {
        "phase_id": 2,
        "status": "pending",
        "progress_percent": 0
      },
      {
        "phase_id": 3,
        "status": "pending",
        "progress_percent": 0
      },
      {
        "phase_id": 4,
        "status": "pending",
        "progress_percent": 0
      },
      {
        "phase_id": 5,
        "status": "pending",
        "progress_percent": 0
      },
      {
        "phase_id": 6,
        "status": "pending",
        "progress_percent": 0
      }
    ],
    "overall_progress_percent": 0,
    "time_tracking": [
      {
        "phase_id": 1,
        "estimated_hours": 4,
        "actual_hours": null,
        "variance_hours": null
      },
      {
        "phase_id": 2,
        "estimated_hours": 4,
        "actual_hours": null,
        "variance_hours": null
      },
      {
        "phase_id": 3,
        "estimated_hours": 4,
        "actual_hours": null,
        "variance_hours": null
      },
      {
        "phase_id": 4,
        "estimated_hours": 4,
        "actual_hours": null,
        "variance_hours": null
      },
      {
        "phase_id": 5,
        "estimated_hours": 4,
        "actual_hours": null,
        "variance_hours": null
      },
      {
        "phase_id": 6,
        "estimated_hours": 4,
        "actual_hours": null,
        "variance_hours": null
      }
    ],
    "notes_and_learnings": [
      "문서 손상 재발 방지를 위해 validate 단계에서 연속 물음표 패턴을 차단한다.",
      "각 Phase 종료 시 quality_gate 항목과 진행률을 함께 업데이트한다.",
      "Top 8 즉시 대응은 AGENTS, PRD, 리스크 레지스터, Plans를 동시 갱신하고 plans_sync + rg 검증 명령으로 정합성을 고정한다.",
      "오픈소스 컴플라이언스는 LICENSE/NOTICE/SBOM/매니페스트 고정과 정책 문서를 함께 갱신해야 통과로 간주한다.",
      "DR-07은 외부 SDK 정책 변화 자동 감시를 도입해 Open에서 Closed로 전환했다.",
      "100% 판정은 문서/검증 범위 기준이며 시점고정(2026-02-09)으로 관리한다."
    ],
    "blockers": [
      {
        "title": "구현 코드 미존재",
        "resolution": "로드맵 문서를 기준으로 Phase 1부터 TDD 순서로 실제 코드와 테스트를 생성한다."
      }
    ]
  }
}
