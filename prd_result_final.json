{
  "document_description": "Final snapshot of PRD cleanup result JSON at the last finalized state.",
  "checklist": [
    "Move CR change details out of PRD body",
    "Keep Database Schema at entity/core-constraint level",
    "Keep API section at MVP scope and key rules",
    "Replace ASCII mockups with concise UX requirements",
    "Move security runbook details to operations docs",
    "Remove appendix priority mapping from PRD",
    "Remove operational Next Steps/Contact from PRD"
  ],
  "solutions": [
    {
      "item": "Move CR change details out of PRD body",
      "options": [
        "Keep as-is",
        "Keep summary only and move details to PR/issue tracker",
        "Move fully to CHANGELOG"
      ]
    },
    {
      "item": "Keep Database Schema at entity/core-constraint level",
      "options": [
        "Keep implementation detail",
        "Keep entities/core constraints only",
        "Delete section"
      ]
    },
    {
      "item": "Keep API section at MVP scope and key rules",
      "options": [
        "Keep full branching detail",
        "Keep MVP scope/core rules/app_codes only",
        "Delete section"
      ]
    },
    {
      "item": "Replace ASCII mockups with concise UX requirements",
      "options": [
        "Keep mockups",
        "Keep screen purpose/key UX summary only",
        "Delete section"
      ]
    },
    {
      "item": "Move security runbook details to operations docs",
      "options": [
        "Keep all runbook detail in PRD",
        "Keep security principles/required controls only",
        "Reduce to one-line policy"
      ]
    },
    {
      "item": "Remove appendix priority mapping from PRD",
      "options": [
        "Keep appendix",
        "Move to backlog tool and remove",
        "Keep top 3 only"
      ]
    },
    {
      "item": "Remove operational Next Steps/Contact from PRD",
      "options": [
        "Keep as-is",
        "Move to operations wiki and remove",
        "Condense to one metadata line"
      ]
    }
  ],
  "chosen_solutions": [
    {
      "item": "Move CR change details out of PRD body",
      "chosen": "Keep summary only and move details to PR/issue tracker"
    },
    {
      "item": "Keep Database Schema at entity/core-constraint level",
      "chosen": "Keep entities/core constraints only"
    },
    {
      "item": "Keep API section at MVP scope and key rules",
      "chosen": "Keep MVP scope/core rules/app_codes only"
    },
    {
      "item": "Replace ASCII mockups with concise UX requirements",
      "chosen": "Keep screen purpose/key UX summary only"
    },
    {
      "item": "Move security runbook details to operations docs",
      "chosen": "Keep security principles/required controls only"
    },
    {
      "item": "Remove appendix priority mapping from PRD",
      "chosen": "Move to backlog tool and remove"
    },
    {
      "item": "Remove operational Next Steps/Contact from PRD",
      "chosen": "Move to operations wiki and remove"
    }
  ],
  "revised_document": "# PRD: 만화/웹툰 AI 번역 서비스 (MVP v1.0)\n\n- 최종 업데이트: 2026-02-07\n- 목표 완료일: PRD 승인일 기준 6주\n- 전략: Quick Wins (실사용 가능한 첫 버전)\n\n---\n\n## 문서 운영 원칙\n\n- PRD에는 현재 유효한 제품 요구사항과 검증 기준만 유지한다.\n- 상세 변경 이력은 PR/이슈 트래커에서 관리한다.\n- 구현 상세(DDL, 에러 매트릭스, 보안 runbook, 운영 체크리스트)는 별도 운영 문서로 분리한다.\n\n---\n\n## Executive Summary\n\n### 제품 정체성\n\n- 제품 정의: 이미지 기반 만화/웹툰 번역 결과물 생성 엔진\n- 핵심 가치:\n  - 시간적 가치: 페이지당 평균 30초 내 처리\n  - 문학적 가치: 레이아웃/말투/용어 일관성을 갖춘 읽기 경험\n\n### North Star (12개월)\n\n- 사용자가 일상적으로 만화/웹툰을 번역해 읽는 반복 사용 도구로 정착한다.\n\n### 성공 정의 (MVP)\n\n- Hard Gate (자동):\n  - 누락 없음: input_text_count == output_text_count\n  - 레이아웃 안정: bbox_overflow == 0 and min_font_pt >= 10\n- Soft Gate (샘플링):\n  - 자연스러움: 골든셋 수동 평가 90% 통과\n  - 정확도: 오역 체크리스트 5개 중 4개 통과\n- 사용자 Gate (cohort_100):\n  - CSAT 평균 >= 4.0/5.0\n  - 무편집 읽기 비율 >= 90%\n\n### 상태 모델 SSOT\n\n- job_status: pending, processing, completed, failed, canceled\n- page_status: success, partial, fail, canceled\n- terminal_non_canceled_pages: success, partial, fail\n- 과금 규칙: success=1.0, partial=0.5, fail/canceled=0\n\n---\n\n## Problem & Solution\n\n### 문제\n\n- 기존 도구는 품질 편차가 크고 레이아웃/용어 일관성이 낮아 몰입을 해친다.\n- 수동 번역은 시간 비용이 높다.\n\n### 솔루션\n\n- OCR + 번역 + 인페인팅 + 식자를 단일 파이프라인으로 자동화한다.\n- 품질 우선 원칙을 적용해, 속도 목표보다 읽기 가능 품질을 우선한다.\n\n---\n\n## Target Users\n\n- 1차 타깃: 해외 만화/웹툰을 빠르게 읽고 싶은 개인 사용자\n- 콘텐츠 범위: 성인 등급 포함\n- 운영 차단 대상: 실존 인물 노출/개인정보 포함 이미지\n\n---\n\n## System Architecture\n\n### 파이프라인\n\n- Preprocess -> Text Detection -> OCR -> Translation -> Inpainting/Typesetting -> Postprocess\n\n### 기술 스택\n\n- Frontend: Next.js + TypeScript\n- Backend: FastAPI + Python\n- Storage/DB: Cloudflare R2 + PostgreSQL\n- Queue: Redis + Worker\n\n### 내결함성\n\n- OpenAI 장애: Gemini fallback\n- OCR 신뢰도 저하: Vision fallback\n- 인페인팅 실패: 제한적 fallback\n\n---\n\n## Core Features (MVP Scope)\n\n### In Scope\n\n- 회원가입/로그인/세션 유지\n- ZIP 업로드 -> 번역 -> 다운로드\n- 작업 진행률 및 페이지별 상태 확인\n- 결과 인라인 편집(허용 상태만)\n- 실패 페이지 재시도(상한 3회)\n- 신고(Report) 생성 및 관리자 처리\n- 크레딧 차감/원장 기록\n\n### Out of Scope\n\n- 실시간 협업 편집\n- 공개 API 제공\n- 고급 스타일 편집기\n\n---\n\n## User Flow\n\n1. 사용자는 로그인 후 번역 파일을 업로드한다.\n2. 시스템은 작업을 생성하고 큐에서 페이지 단위로 처리한다.\n3. 사용자는 진행률/상태를 조회한다.\n4. 완료 후 결과물을 다운로드하거나 필요한 페이지를 편집/재시도한다.\n5. 이슈가 있으면 신고를 생성한다.\n\n---\n\n## Business Model & Constraints\n\n### 크레딧\n\n- 신규 사용자 기본 크레딧 제공\n- 페이지 상태별 차감 규칙 적용\n\n### 운영 제약\n\n- 사용자별 활성 작업 1건 제한\n- 일일 비용 상한 초과 시 신규 작업 차단\n- 환율 스냅샷 누락 시 fail-closed\n\n### 성능 목표\n\n- 평균 처리 시간: < 30초/페이지\n- 페이지 타임아웃: 120초\n\n---\n\n## Content Moderation\n\n- 업로드 전 경고 문구 제공\n- 결과 페이지마다 신고 기능 제공\n- 신고 상태: open, reviewing, resolved, rejected\n- 중복 신고 및 쿨다운 정책 적용\n\n---\n\n## Quality Assurance\n\n### 테스트 원칙\n\n- 골든셋 회귀 테스트를 릴리즈 게이트로 사용\n- KPI 계산은 최종 terminal 상태 기준으로 집계\n\n### 최소 게이트\n\n- 성공률 >= 90%\n- 사용 가능률 >= 95%\n- 회귀세트 기준 품질 임계 충족\n\n---\n\n## Database Schema (요약)\n\n### 핵심 엔터티\n\n- users: 계정/권한/크레딧\n- jobs: 작업 단위 상태/진행률\n- pages: 페이지 단위 결과/재시도/편집\n- idempotency_keys: 쓰기 요청 멱등성\n- credit_ledger: 크레딧 감사 원장\n- api_cost_events: 외부 API 비용 원장\n- reports: 신고 상태머신\n- security_events: 보안 이벤트\n- download_events, cohort_100_members: KPI 집계 근거\n\n### 제약\n\n- 시간 컬럼은 UTC TIMESTAMPTZ 기준\n- append-only 원장 정책 유지\n- 상태 전이와 과금 규칙은 PRD SSOT를 따른다\n\n---\n\n## API Endpoints (요약)\n\n### 도메인\n\n- Auth: signup/login/refresh/logout\n- Users: me/csat\n- Jobs: create/list/detail/cancel/download\n- Pages: list/retry/edit/download\n- Reports: create\n- Admin: report review/resolve/reject\n\n### 공통 규칙\n\n- 쓰기 API는 Idempotency-Key 필수(인증 엔드포인트 예외)\n- 표준 app_code로 오류를 분기한다\n- 정책 차단은 은닉 우선 규칙을 적용한다\n\n### 주요 app_code\n\n- 입력: UNSUPPORTED_FILE_TYPE, MAX_PAGES_EXCEEDED, ARCHIVE_PARSE_FAILED\n- 제한: TEMPORARILY_BLOCKED, DAILY_PAGE_LIMIT_EXCEEDED, HOURLY_PAGE_LIMIT_EXCEEDED, QUEUE_CAPACITY_EXCEEDED\n- 비용: COST_DAILY_LIMIT_EXCEEDED, FX_RATE_UNAVAILABLE\n- 경합: ACTIVE_JOB_ALREADY_EXISTS, IDEMPOTENCY_IN_PROGRESS, PAGE_NOT_EDITABLE, PAGE_RETRY_LIMIT_EXCEEDED\n\n---\n\n## Security & Privacy (요약)\n\n- JWT 기반 인증 + Refresh 회전\n- CSRF/CORS 기본 차단 정책\n- RBAC(user/admin) 최소권한 적용\n- Rate limiting 및 이상행동 이벤트 기록\n- 민감정보 최소수집, 저장 암호화, 전송 TLS 강제\n- override는 2인 승인 + 만료시간 + 사후조치 필수\n\n---\n\n## Success Metrics\n\n### 기술 KPI\n\n- success_rate = success / terminal_non_canceled_pages\n- usable_rate = (success + partial) / terminal_non_canceled_pages\n- no_edit_rate = count(edited=false and page_status=success) / count(page_status=success)\n- fallback_rate = fallback_pages / terminal_non_canceled_pages\n- cost_per_page = total_external_api_cost_krw / terminal_non_canceled_pages\n\n### 운영 KPI\n\n- DAU/MAU\n- 크레딧 소진율\n- 유료 전환율(관찰 지표)\n\n---\n\n## Risk Mitigation\n\n- API 장애: circuit breaker + fallback\n- 비용 폭주: 일일 상한/차단/경보\n- 과부하: 큐 모니터링 + 동시성 제어\n- 정책 위반: 신고/검토/차단 프로세스\n\n---\n\n## Definition of Done (MVP)\n\n### 기능\n\n- E2E 업로드 -> 번역 -> 다운로드 동작\n- 상태 모델/과금 규칙 UI/API/DB 일치\n- 취소/재시도/편집 제약 규칙 준수\n- 신고/권한/오류 코드 정책 검증\n\n### 품질\n\n- 성공률 90% 이상\n- 사용 가능률 95% 이상\n- 타임아웃/재시도 정책 검증\n\n### 운영\n\n- 환경 분리(dev/staging/prod)\n- 로그/알림/비용 통제 동작\n- 배포 및 기본 사용자 가이드 준비\n\n---\n\n> 문서 버전: v1.0\n> 최종 업데이트: 2026-02-07\n",
  "verification": "Regenerated all result JSON files and validated UTF-8 parsing integrity.\nClarified KPI formula with explicit count-based numerator/denominator to remove ambiguity."
}